<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1200, initial-scale=0.35">
<title>Personal Tracker</title>

<style>
body{min-width:1200px;font-family:system-ui,sans-serif;margin:20px}
@media (prefers-color-scheme: dark){body{background:#000;color:#fff}.card,table,th,td{border-color:#555}}
@media (prefers-color-scheme: light){body{background:#fff;color:#000}.card,table,th,td{border-color:#000}}
:root{--accent:#6aa6ff}
h1{color:var(--accent)}
.small{font-size:12px;opacity:.75}
.card{border:1px solid;border-radius:14px;padding:14px;margin-top:20px}
table{width:100%;border-collapse:collapse;table-layout:fixed}
th,td{border:1px solid;font-size:12px;text-align:center}
th:first-child,td:first-child{width:180px;text-align:left;padding-left:8px}
td.cell{aspect-ratio:1/1;height:26px}
input.inline{width:100%;border:none;background:transparent;color:inherit;font-size:12px}
.remove-btn{font-size:11px;margin-left:6px;cursor:pointer;opacity:.6}
button{margin-top:8px;padding:6px 12px;border:1px solid var(--accent);background:transparent;color:var(--accent);border-radius:8px}
.sleep-wrap{display:flex;gap:14px;margin-top:10px}
.sleep-left{width:40%}
.sleep-right{width:60%}
svg{width:100%;height:160px}
</style>
</head>

<body>

<h1>ðŸ§  Personal Tracker</h1>
<div id="dateTime" class="small"></div>

<!-- HABITS (UNCHANGED) -->
<div class="card">
<b>Habits</b>
<div id="todayProgress" class="small"></div>
<table id="habitTable"></table>
<button onclick="addHabit()">+ Add habit</button>
</div>

<!-- SLEEP -->
<div class="card">
<b>Sleep Tracker</b>

<div class="sleep-wrap">
  <div class="sleep-left">
    <table id="sleepTable"></table>
  </div>
  <div class="sleep-right card">
    <div class="small">Daily Sleep (hrs)</div>
    <svg id="sleepGraph"></svg>
    <div class="small" style="margin-top:10px">Weekly Average</div>
    <svg id="weeklyGraph"></svg>
  </div>
</div>
</div>

<script>
const now=new Date();
const Y=now.getFullYear();
const M=now.getMonth();
const TODAY=now.getDate();
const DAYS=new Date(Y,M+1,0).getDate();
const KEY=`tracker-${Y}-${M}`;

let data=JSON.parse(localStorage.getItem(KEY))||{
  habits:Array(5).fill().map(()=>({name:"",checks:{}})),
  sleep:{} // { day: {start,end,hrs} }
};

function save(){localStorage.setItem(KEY,JSON.stringify(data));render();}

/* ---------------- HABITS (UNCHANGED) ---------------- */
function addHabit(){data.habits.push({name:"",checks:{}});save();}
function removeHabit(i){data.habits.splice(i,1);save();}
function toggleHabit(i,d){data.habits[i].checks[d]=!data.habits[i].checks[d];save();}

function renderHabits(){
  habitTable.innerHTML="";
  let h="<tr><th>Habit</th>";
  for(let d=1;d<=DAYS;d++)h+=`<th>${d}</th>`;
  h+="</tr>";
  habitTable.innerHTML=h;

  let done=0;
  data.habits.forEach((hb,i)=>{
    let r=`<tr><td>
      <input class="inline" value="${hb.name}"
      oninput="data.habits[${i}].name=this.value;save()">
      <span class="remove-btn" onclick="removeHabit(${i})">Ã—</span>
    </td>`;
    for(let d=1;d<=DAYS;d++){
      if(d===TODAY&&hb.checks[d])done++;
      r+=`<td class="cell" onclick="toggleHabit(${i},${d})">${hb.checks[d]?'âœ”':''}</td>`;
    }
    r+="</tr>";
    habitTable.innerHTML+=r;
  });
  todayProgress.innerText=`Today: ${done}/${data.habits.length}`;
}

/* ---------------- SLEEP AUTO + MANUAL ---------------- */
function calcHours(s,e){
  if(!s||!e)return null;
  let a=new Date(`1970-01-01T${s}`);
  let b=new Date(`1970-01-01T${e}`);
  if(b<a)b.setDate(b.getDate()+1);
  return +((b-a)/36e5).toFixed(1);
}

function renderSleep(){
  sleepTable.innerHTML="<tr><th>Day</th><th>Slept</th><th>Woke</th><th>Hrs</th></tr>";
  let points=[];
  let weekly=[[],[],[],[],[]];

  for(let d=1;d<=DAYS;d++){
    const s=data.sleep[d]||{};
    sleepTable.innerHTML+=`
    <tr>
      <td>${d}</td>
      <td><input type="time" class="inline"
        value="${s.start||""}"
        onchange="data.sleep[${d}]={...data.sleep[${d}],start:this.value,hrs:calcHours(this.value,data.sleep[${d}]?.end)};save()"></td>
      <td><input type="time" class="inline"
        value="${s.end||""}"
        onchange="data.sleep[${d}]={...data.sleep[${d}],end:this.value,hrs:calcHours(data.sleep[${d}]?.start,this.value)};save()"></td>
      <td><input type="number" step="0.1" class="inline"
        value="${s.hrs??""}"
        oninput="data.sleep[${d}]={...data.sleep[${d}],hrs:Number(this.value)};save()"></td>
    </tr>`;

    if(s.hrs!=null){
      points.push(s.hrs);
      weekly[Math.floor((d-1)/7)].push(s.hrs);
    }
  }

  drawLineGraph(sleepGraph,points);
  drawBarGraph(weeklyGraph,weekly.map(w=>w.length?(w.reduce((a,b)=>a+b)/w.length):0));
}

/* ---------------- GRAPHS ---------------- */
function drawLineGraph(svg,data){
  svg.innerHTML="";
  if(!data.length)return;
  const w=svg.clientWidth,h=svg.clientHeight,p=20,max=10;
  let pts=data.map((v,i)=>({
    x:p+i*(w-2*p)/(data.length-1||1),
    y:h-p-(v/max)*(h-2*p)
  }));
  svg.innerHTML+=`<polyline points="${pts.map(p=>`${p.x},${p.y}`).join(" ")}" fill="none" stroke="currentColor"/>`;
  pts.forEach(p=>svg.innerHTML+=`<circle cx="${p.x}" cy="${p.y}" r="3" fill="currentColor"/>`);
}

function drawBarGraph(svg,data){
  svg.innerHTML="";
  const w=svg.clientWidth,h=svg.clientHeight,p=20,max=10;
  const bw=(w-2*p)/data.length;
  data.forEach((v,i)=>{
    const bh=(v/max)*(h-2*p);
    svg.innerHTML+=`<rect x="${p+i*bw}" y="${h-p-bh}" width="${bw-6}" height="${bh}" fill="currentColor"/>`;
  });
}

/* ---------------- CLOCK ---------------- */
setInterval(()=>{
  dateTime.innerText=new Date().toLocaleDateString()+" "+
  new Date().toLocaleTimeString([],{
    hour:'numeric',minute:'2-digit',second:'2-digit',hour12:true
  });
},1000);

function render(){renderHabits();renderSleep();}
render();
</script>

</body>
</html>
